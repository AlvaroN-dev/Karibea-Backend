# =============================================================================
# KARIBEA BACKEND - ENVIRONMENT CONFIGURATION (PRODUCTION)
# =============================================================================
# All values are externalized here. docker-compose.prod.yml only uses ${VAR}
# =============================================================================

# -----------------------------------------------------------------------------
# DATABASE CONFIGURATION
# -----------------------------------------------------------------------------
DB_USERNAME=postgres
DB_PASSWORD=karibea234*

# HikariCP Connection Pool (optimized for 14 microservices on single VM)
SPRING_DATASOURCE_HIKARI_MAXIMUM_POOL_SIZE=3
SPRING_DATASOURCE_HIKARI_MINIMUM_IDLE=1
SPRING_DATASOURCE_HIKARI_CONNECTION_TIMEOUT=30000
SPRING_DATASOURCE_HIKARI_IDLE_TIMEOUT=600000
SPRING_DATASOURCE_HIKARI_MAX_LIFETIME=1800000

# Database URLs for each microservice
SPRING_DATASOURCE_URL_CATALOG=jdbc:postgresql://postgres:5432/karibea_catalog
SPRING_DATASOURCE_URL_CHATBOT=jdbc:postgresql://postgres:5432/karibea_chatbot
SPRING_DATASOURCE_URL_IDENTITY=jdbc:postgresql://postgres:5432/karibea_identity
SPRING_DATASOURCE_URL_INVENTORY=jdbc:postgresql://postgres:5432/karibea_inventory
SPRING_DATASOURCE_URL_MARKETING=jdbc:postgresql://postgres:5432/karibea_marketing
SPRING_DATASOURCE_URL_NOTIFICATION=jdbc:postgresql://postgres:5432/karibea_notification
SPRING_DATASOURCE_URL_ORDER=jdbc:postgresql://postgres:5432/karibea_order
SPRING_DATASOURCE_URL_PAYMENT=jdbc:postgresql://postgres:5432/karibea_payment
SPRING_DATASOURCE_URL_REVIEW=jdbc:postgresql://postgres:5432/karibea_review
SPRING_DATASOURCE_URL_SEARCH=jdbc:postgresql://postgres:5432/karibea_search
SPRING_DATASOURCE_URL_SHIPPING=jdbc:postgresql://postgres:5432/karibea_shipping
SPRING_DATASOURCE_URL_SHOPCART=jdbc:postgresql://postgres:5432/karibea_shopcart
SPRING_DATASOURCE_URL_STORE=jdbc:postgresql://postgres:5432/karibea_store
SPRING_DATASOURCE_URL_USER=jdbc:postgresql://postgres:5432/karibea_user

# JPA Configuration
SPRING_JPA_HIBERNATE_DDL_AUTO_PROD=validate
SPRING_JPA_SHOW_SQL_PROD=false

# -----------------------------------------------------------------------------
# SPRING PROFILES
# -----------------------------------------------------------------------------
SPRING_PROFILES_ACTIVE_PROD=prod

# -----------------------------------------------------------------------------
# CONFIG SERVER
# -----------------------------------------------------------------------------
SERVER_PORT_CONFIG=8888
SPRING_PROFILES_CONFIG=native,prod
SPRING_CLOUD_CONFIG_SERVER_NATIVE_SEARCH_LOCATIONS=classpath:/config/
EUREKA_CLIENT_ENABLED_CONFIG=false
SPRING_CONFIG_IMPORT=optional:configserver:http://microservice-config:8888

# -----------------------------------------------------------------------------
# EUREKA CONFIGURATION
# -----------------------------------------------------------------------------
SERVER_PORT_EUREKA=8761
EUREKA_CLIENT_REGISTER_WITH_EUREKA=false
EUREKA_CLIENT_FETCH_REGISTRY=false
EUREKA_SERVER_ENABLE_SELF_PRESERVATION=true
EUREKA_SERVER_RENEWAL_PERCENT_THRESHOLD=0.85
EUREKA_SERVER_EVICTION_INTERVAL_TIMER_IN_MS=10000
EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://microservice-eureka:8761/eureka/

# -----------------------------------------------------------------------------
# GATEWAY CONFIGURATION
# -----------------------------------------------------------------------------
SERVER_PORT_GATEWAY=8080

# -----------------------------------------------------------------------------
# MICROSERVICE PORTS
# -----------------------------------------------------------------------------
SERVER_PORT_CATALOG=8081
SERVER_PORT_IDENTITY=8082
SERVER_PORT_USER=8083
SERVER_PORT_ORDER=8084
SERVER_PORT_PAYMENT=8085
SERVER_PORT_INVENTORY=8086
SERVER_PORT_SHOPCART=8087
SERVER_PORT_SHIPPING=8088
SERVER_PORT_NOTIFICATION=8089
SERVER_PORT_MARKETING=8090
SERVER_PORT_REVIEW=8091
SERVER_PORT_SEARCH=8092
SERVER_PORT_STORE=8093
SERVER_PORT_CHATBOT=8094

# -----------------------------------------------------------------------------
# MICROSERVICE NAMES
# -----------------------------------------------------------------------------
SPRING_APPLICATION_NAME_CONFIG=microservice-config
SPRING_APPLICATION_NAME_EUREKA=microservice-eureka
SPRING_APPLICATION_NAME_GATEWAY=microservice-gateway
SPRING_APPLICATION_NAME_CATALOG=microservice-catalog
SPRING_APPLICATION_NAME_IDENTITY=microservice-identity
SPRING_APPLICATION_NAME_USER=microservice-user
SPRING_APPLICATION_NAME_ORDER=microservice-order
SPRING_APPLICATION_NAME_PAYMENT=microservice-payment
SPRING_APPLICATION_NAME_INVENTORY=microservice-inventory
SPRING_APPLICATION_NAME_SHOPCART=microservice-shopcart
SPRING_APPLICATION_NAME_SHIPPING=microservice-shipping
SPRING_APPLICATION_NAME_NOTIFICATION=microservice-notification
SPRING_APPLICATION_NAME_MARKETING=microservice-marketing
SPRING_APPLICATION_NAME_REVIEW=microservice-review
SPRING_APPLICATION_NAME_SEARCH=microservice-search
SPRING_APPLICATION_NAME_STORE=microservice-store
SPRING_APPLICATION_NAME_CHATBOT=microservice-chatbot

# -----------------------------------------------------------------------------
# KAFKA CONFIGURATION
# -----------------------------------------------------------------------------
KAFKA_CLUSTER_ID=MkU3OEVBNTcwNTJENDM2Qk
KAFKA_BOOTSTRAP_SERVERS=kafka-0:9092,kafka-1:9092,kafka-2:9092
KAFKA_LOG_RETENTION_HOURS=168
KAFKA_LOG_RETENTION_BYTES=1073741824

# Kafka Common Settings
KAFKA_PROCESS_ROLES=broker,controller
KAFKA_CONTROLLER_QUORUM_VOTERS=0@kafka-0:9093,1@kafka-1:9093,2@kafka-2:9093
KAFKA_CONTROLLER_LISTENER_NAMES=CONTROLLER
KAFKA_INTER_BROKER_LISTENER_NAME=PLAINTEXT
KAFKA_LOG_DIRS=/var/lib/kafka/data

# Kafka Node IDs
KAFKA_NODE_ID_0=0
KAFKA_NODE_ID_1=1
KAFKA_NODE_ID_2=2

# Kafka Development Settings
KAFKA_LISTENERS_0=PLAINTEXT://0.0.0.0:9092,CONTROLLER://0.0.0.0:9093,EXTERNAL://0.0.0.0:9094
KAFKA_ADVERTISED_LISTENERS_0=PLAINTEXT://kafka-0:9092,EXTERNAL://localhost:9094
KAFKA_LISTENERS_1=PLAINTEXT://0.0.0.0:9092,CONTROLLER://0.0.0.0:9093,EXTERNAL://0.0.0.0:9095
KAFKA_ADVERTISED_LISTENERS_1=PLAINTEXT://kafka-1:9092,EXTERNAL://localhost:9095
KAFKA_LISTENERS_2=PLAINTEXT://0.0.0.0:9092,CONTROLLER://0.0.0.0:9093,EXTERNAL://0.0.0.0:9096
KAFKA_ADVERTISED_LISTENERS_2=PLAINTEXT://kafka-2:9092,EXTERNAL://localhost:9096
KAFKA_LISTENER_SECURITY_PROTOCOL_MAP=PLAINTEXT:PLAINTEXT,CONTROLLER:PLAINTEXT,EXTERNAL:PLAINTEXT
KAFKA_HEAP_OPTS=-Xms256m -Xmx512m
KAFKA_AUTO_CREATE_TOPICS_ENABLE=true
KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR=1
KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR=1
KAFKA_TRANSACTION_STATE_LOG_MIN_ISR=1

# Kafka Production Settings
KAFKA_LISTENERS_PROD_0=PLAINTEXT://0.0.0.0:9092,CONTROLLER://0.0.0.0:9093
KAFKA_ADVERTISED_LISTENERS_PROD_0=PLAINTEXT://kafka-0:9092
KAFKA_LISTENERS_PROD_1=PLAINTEXT://0.0.0.0:9092,CONTROLLER://0.0.0.0:9093
KAFKA_ADVERTISED_LISTENERS_PROD_1=PLAINTEXT://kafka-1:9092
KAFKA_LISTENERS_PROD_2=PLAINTEXT://0.0.0.0:9092,CONTROLLER://0.0.0.0:9093
KAFKA_ADVERTISED_LISTENERS_PROD_2=PLAINTEXT://kafka-2:9092
KAFKA_LISTENER_SECURITY_PROTOCOL_MAP_PROD=PLAINTEXT:PLAINTEXT,CONTROLLER:PLAINTEXT
KAFKA_HEAP_OPTS_PROD=-Xms384m -Xmx768m
KAFKA_AUTO_CREATE_TOPICS_ENABLE_PROD=false
KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR_PROD=3
KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR_PROD=3
KAFKA_TRANSACTION_STATE_LOG_MIN_ISR_PROD=2
KAFKA_MIN_INSYNC_REPLICAS=2
KAFKA_DEFAULT_REPLICATION_FACTOR=3
KAFKA_NUM_PARTITIONS=6
KAFKA_LOG_SEGMENT_BYTES=1073741824
KAFKA_LOG_CLEANUP_POLICY=delete
KAFKA_JVM_PERFORMANCE_OPTS=-XX:+UseG1GC -XX:MaxGCPauseMillis=20 -XX:InitiatingHeapOccupancyPercent=35

# -----------------------------------------------------------------------------
# JWT / SECURITY CONFIGURATION
# -----------------------------------------------------------------------------
JWT_SECRET=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzUxMiJ9.eyJqdGkiOiIyYjdjMWU5MS0yNDA3LTRmNjItYTI0Ni1iZDJiMTc2MzIyZTEiLCJyb2xlcyI6WyJST0xFX0FETUlOIiwiUk9MRV9BTkFMSVNUQSIsIlJPTEVfQUZJTElBRE8iXSwidXNlcklkIjoxLCJlbWFpbCI6ImFkbWluQHJpd2kuaW8iLCJzdWIiOiJhZG1pbiIsImlhdCI6MTc2NTMyMDEwMSwiZXhwIjoxNzY1NDA2NTAxfQ.eyreiVd4vc80ik93GYDn4yeGGbYBwMdtFarBzalH9RQGluYc2rPc9VyrSIJiUsGBqOan2iLxX2YKLjMUTkJPuQ
JWT_EXPIRATION=86400000
JWT_ISSUER_URI=http://microservice-identity:8082

# -----------------------------------------------------------------------------
# OAUTH2 - GOOGLE
# -----------------------------------------------------------------------------
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=

# -----------------------------------------------------------------------------
# PAYMENT PROVIDERS
# -----------------------------------------------------------------------------
STRIPE_API_KEY=sk_test_xxx
STRIPE_WEBHOOK_SECRET=whsec_xxx
PAYPAL_CLIENT_ID=
PAYPAL_CLIENT_SECRET=

# -----------------------------------------------------------------------------
# EMAIL CONFIGURATION
# -----------------------------------------------------------------------------
MAIL_HOST=smtp.gmail.com
MAIL_PORT=587
MAIL_USERNAME=
MAIL_PASSWORD=

# -----------------------------------------------------------------------------
# TWILIO (SMS/WhatsApp)
# -----------------------------------------------------------------------------
TWILIO_ACCOUNT_SID=
TWILIO_AUTH_TOKEN=
TWILIO_PHONE_NUMBER=

# -----------------------------------------------------------------------------
# ELASTICSEARCH
# -----------------------------------------------------------------------------
ELASTICSEARCH_URIS=http://elasticsearch:9200

# -----------------------------------------------------------------------------
# AI / CHATBOT
# -----------------------------------------------------------------------------
CHATBOT_AI21_API_KEY=570d64f3-4df9-41cc-b724-19f4f3a15e55
CHATBOT_AI21_API_URL=https://api.ai21.com/studio/v1/chat/completions
CHATBOT_AI21_MODEL=jamba-mini-1.7
CHATBOT_AI21_MAX_TOKENS=300
CHATBOT_AI21_TEMPERATURE=0.7
OPENAI_API_KEY=sk-xxx
OPENAI_MODEL=gpt-4o-mini

# -----------------------------------------------------------------------------
# DOCKER REGISTRY
# -----------------------------------------------------------------------------
DOCKER_REGISTRY=
VERSION=latest

# -----------------------------------------------------------------------------
# JAVA TOOL OPTIONS (Production - per service type)
# -----------------------------------------------------------------------------
JAVA_TOOL_OPTIONS_CONFIG=-Xms192m -Xmx320m -XX:+UseG1GC -XX:MaxGCPauseMillis=100 -XX:+UseStringDeduplication -Djava.security.egd=file:/dev/./urandom
JAVA_TOOL_OPTIONS_EUREKA=-Xms256m -Xmx384m -XX:+UseG1GC -XX:MaxGCPauseMillis=100 -Djava.security.egd=file:/dev/./urandom
JAVA_TOOL_OPTIONS_GATEWAY=-Xms384m -Xmx512m -XX:+UseG1GC -XX:MaxGCPauseMillis=50 -XX:+UseStringDeduplication -Dio.netty.leakDetection.level=disabled -Djava.security.egd=file:/dev/./urandom
JAVA_TOOL_OPTIONS_IDENTITY=-Xms256m -Xmx384m -XX:+UseG1GC -XX:MaxGCPauseMillis=100 -Djava.security.egd=file:/dev/./urandom
JAVA_TOOL_OPTIONS_SERVICE=-Xms192m -Xmx320m -XX:+UseG1GC -XX:MaxGCPauseMillis=100 -XX:+UseStringDeduplication -Djava.security.egd=file:/dev/./urandom

# -----------------------------------------------------------------------------
# RESOURCE LIMITS (Docker Compose mem_limit/cpus)
# -----------------------------------------------------------------------------
# PostgreSQL
MEM_LIMIT_POSTGRES=2560m
MEM_RESERVATION_POSTGRES=1024m
CPUS_POSTGRES=0.8

# Kafka brokers
MEM_LIMIT_KAFKA=1280m
MEM_RESERVATION_KAFKA=768m
CPUS_KAFKA=0.5

# Config Server
MEM_LIMIT_CONFIG=384m
MEM_RESERVATION_CONFIG=256m
CPUS_CONFIG=0.2

# Eureka
MEM_LIMIT_EUREKA=512m
MEM_RESERVATION_EUREKA=320m
CPUS_EUREKA=0.3

# Gateway
MEM_LIMIT_GATEWAY=768m
MEM_RESERVATION_GATEWAY=512m
CPUS_GATEWAY=0.5

# Identity (critical service)
MEM_LIMIT_IDENTITY=512m
MEM_RESERVATION_IDENTITY=320m
CPUS_IDENTITY=0.3

# Business services
MEM_LIMIT_SERVICE=448m
MEM_RESERVATION_SERVICE=256m
CPUS_SERVICE=0.25

# -----------------------------------------------------------------------------
# POSTGRESQL TUNING
# -----------------------------------------------------------------------------
POSTGRES_MAX_CONNECTIONS=100
POSTGRES_SHARED_BUFFERS=512MB
POSTGRES_EFFECTIVE_CACHE_SIZE=1536MB
POSTGRES_WORK_MEM=4MB
POSTGRES_MAINTENANCE_WORK_MEM=128MB
POSTGRES_WAL_BUFFERS=32MB
POSTGRES_MIN_WAL_SIZE=512MB
POSTGRES_MAX_WAL_SIZE=2GB
POSTGRES_CHECKPOINT_COMPLETION_TARGET=0.9
POSTGRES_RANDOM_PAGE_COST=1.1
POSTGRES_EFFECTIVE_IO_CONCURRENCY=200
POSTGRES_DEFAULT_STATISTICS_TARGET=100
POSTGRES_LOG_STATEMENT=none
POSTGRES_LOG_DURATION=off
POSTGRES_LOG_MIN_DURATION_STATEMENT=1000

# -----------------------------------------------------------------------------
# HEALTHCHECK CONFIGURATION
# -----------------------------------------------------------------------------
HEALTHCHECK_INTERVAL_INFRA=15s
HEALTHCHECK_TIMEOUT_INFRA=10s
HEALTHCHECK_RETRIES_INFRA=10
HEALTHCHECK_START_PERIOD_INFRA=60s

HEALTHCHECK_INTERVAL_SERVICE=30s
HEALTHCHECK_TIMEOUT_SERVICE=10s
HEALTHCHECK_RETRIES_SERVICE=5
HEALTHCHECK_START_PERIOD_SERVICE=120s

HEALTHCHECK_INTERVAL_KAFKA=30s
HEALTHCHECK_TIMEOUT_KAFKA=15s
HEALTHCHECK_RETRIES_KAFKA=5
HEALTHCHECK_START_PERIOD_KAFKA=90s

# -----------------------------------------------------------------------------
# NETWORK CONFIGURATION
# -----------------------------------------------------------------------------
NETWORK_SUBNET_PROD=172.28.0.0/16


