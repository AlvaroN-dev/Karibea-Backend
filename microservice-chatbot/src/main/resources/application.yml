# =====================================================
# Spring Application Configuration - Chatbot Service
# =====================================================
spring:
  application:
    name: microservice-chatbot
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:dev}

# Server Configuration
server:
  port: ${SERVER_PORT:8087}
  servlet:
    context-path: /api

# JPA Configuration
spring.jpa:
  hibernate:
    ddl-auto: validate
  show-sql: false
  properties:
    hibernate:
      format_sql: true
      dialect: org.hibernate.dialect.PostgreSQLDialect

# =====================================================
# AI Provider Configuration (Provider-Agnostic)
# =====================================================
ai:
  provider: ${AI_PROVIDER:ai21}
  
  # AI21 Studio Configuration
  ai21:
    api:
      key: ${CHATBOT_AI21_API_KEY}
      url: ${CHATBOT_AI21_API_URL:https://api.ai21.com/studio/v1/chat/completions}
      model: ${CHATBOT_AI21_MODEL:jamba-mini-1.7}
    max-tokens: ${CHATBOT_AI21_MAX_TOKENS:300}
    temperature: ${CHATBOT_AI21_TEMPERATURE:0.7}

# =====================================================
# RAG Configuration
# =====================================================
rag:
  context:
    max-items: ${RAG_MAX_CONTEXT_ITEMS:10}
    max-snippet-length: ${RAG_MAX_SNIPPET_LENGTH:500}
  retriever:
    type: ${RAG_RETRIEVER_TYPE:sql}

# =====================================================
# HTTP Client Configuration
# =====================================================
http:
  client:
    connect-timeout: ${HTTP_CONNECT_TIMEOUT:10000}
    read-timeout: ${HTTP_READ_TIMEOUT:30000}
    max-connections: ${HTTP_MAX_CONNECTIONS:20}

# =====================================================
# Resilience4j Configuration
# =====================================================
resilience4j:
  circuitbreaker:
    instances:
      aiProvider:
        registerHealthIndicator: true
        slidingWindowSize: 10
        minimumNumberOfCalls: 5
        permittedNumberOfCallsInHalfOpenState: 3
        automaticTransitionFromOpenToHalfOpenEnabled: true
        waitDurationInOpenState: 30s
        failureRateThreshold: 50
        slowCallRateThreshold: 80
        slowCallDurationThreshold: 10s
  ratelimiter:
    instances:
      aiProvider:
        registerHealthIndicator: true
        limitForPeriod: 100
        limitRefreshPeriod: 1m
        timeoutDuration: 5s

# =====================================================
# OpenAPI Configuration
# =====================================================
springdoc:
  api-docs:
    path: /api-docs
  swagger-ui:
    path: /swagger-ui.html
    operationsSorter: method

# =====================================================
# Actuator Configuration
# =====================================================
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,circuitbreakers
  endpoint:
    health:
      show-details: when_authorized

# =====================================================
# Logging Configuration
# =====================================================
logging:
  level:
    root: INFO
    com.microservice.chatbot: ${LOGGING_LEVEL_CHATBOT:INFO}
    org.springframework.web: INFO
